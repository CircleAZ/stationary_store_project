{# customers/templates/partials/customer_form_fields.html #}

{# NOTE: This template fragment is loaded into a modal via JavaScript #}
{# It assumes the <form> tag wrapping it is handled by the JS that loads it, #}
{# OR that the submit button here triggers the JS listener. #}
{# Let's include the <form> tag here for self-containment, handled by JS submit listener. #}

<form method="post" novalidate id="customer-modal-form"> {# Added ID for potential targeting #}
  {% csrf_token %} {# Still need CSRF token for the async POST submission #}

  {# General error placeholder (for non-field errors or save errors displayed by JS) #}
  <div id="customer-modal-non-field-errors" class="text-danger mb-2 small"></div>

  {# --- Explicit Render for Phone Group --- #}
  <div class="mb-3">
      <label class="form-label d-block">Phone Number</label>
      <div class="input-group input-group-sm"> {# Use small inputs in modal #}
          <span class="input-group-text" style="min-width: 50px;">Code</span>
          {{ form.country_code }} {# Render country_code dropdown #}
          {{ form.phone_number }} {# Render phone_number input #}
      </div>
      {# Placeholders for JS to insert errors #}
      <div id="error_id_country_code" class="invalid-feedback d-block small"></div>
      <div id="error_id_phone_number" class="invalid-feedback d-block small"></div>
  </div>
  {# --- End Explicit Phone Render ---#}

  {# --- Render Remaining Fields via Loop --- #}
  {% for field in form %}
    {# Exclude fields we rendered manually above #}
    {% if field.name != 'country_code' and field.name != 'phone_number' %}
      <div class="mb-3">
        {{ field.label_tag }} {# Render label #}

        {# Conditional styling/rendering for specific field types #}
        {% if field.name == 'groups' or field.name == 'location_tags' %}
           {# Container for checkboxes #}
           <div class="border p-2 rounded form-control form-control-sm" style="max-height: 110px; overflow-y: auto;"> {# Smaller height #}
               {{ field }} {# Renders checkboxes #}
           </div>
        {% elif field.name == 'notes' %}
            {{ field }} {# Renders textarea (widget set in forms.py) #}
        {% else %}
           {{ field }} {# Render all other fields normally #}
        {% endif %}
        {# End conditional field rendering #}

        {# Render help text #}
        {% if field.help_text %}<small class="form-text text-muted">{{ field.help_text }}</small>{% endif %}
        {# Placeholder for JS to insert field-specific errors #}
        <div id="error_{{ field.auto_id }}" class="invalid-feedback d-block small"></div>
      </div>
    {% endif %} {# End exclusion if #}
  {% endfor %}
  {# --- End Loop --- #}

  {# --- Submit Button for Modal (triggers JS listener) --- #}
  <div class="mt-3 pt-3 border-top d-flex justify-content-end">
       {# This button's click doesn't directly submit; #}
       {# it triggers the 'submit' event on the form, handled by JS #}
       <button type="submit" class="btn btn-primary btn-sm">Save Customer</button>
       {# Cancel button handled by modal's standard close button #}
  </div>
  {# --- End Submit Button --- #}

</form> {# End Form #}